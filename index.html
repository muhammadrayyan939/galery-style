<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi Lengkap</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }

        .hidden {
            display: none;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-open { background: #51cf66; }
        .status-closed { background: #ff6b6b; }

        .employee-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-pic {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #667eea;
        }

        .employee-info {
            flex: 1;
        }

        .employee-actions {
            display: flex;
            gap: 10px;
        }

        .attendance-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-hadir { background: #d4edda; color: #155724; }
        .status-tidak-hadir { background: #f8d7da; color: #721c24; }

        .navigation {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: white;
            color: #667eea;
        }

        .time-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .barcode-container {
            text-align: center;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            margin: 20px 0;
        }

        .barcode {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            font-weight: bold;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        .current-time {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .time-settings {
                grid-template-columns: 1fr;
            }
            
            .employee-card {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Sistem Absensi Lengkap</h1>
            <p>Kelola absensi karyawan dengan mudah dan profesional</p>
        </div>

        <div class="current-time" id="currentTime"></div>

        <!-- Login Form -->
        <div id="loginSection" class="card">
            <h2>üîê Login Sistem</h2>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="loginUsername" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="loginPassword" placeholder="Masukkan password">
            </div>
            <button class="btn" onclick="login()">Login</button>
            <button class="btn btn-success" onclick="showSection('registerSection')">Daftar Karyawan Baru</button>
        </div>

        <!-- Registration Form -->
        <div id="registerSection" class="card hidden">
            <h2>üìù Pendaftaran Karyawan Baru</h2>
            <div class="form-group">
                <label>Nama Lengkap:</label>
                <input type="text" id="regName" placeholder="Masukkan nama lengkap">
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="regEmail" placeholder="Masukkan email">
            </div>
            <div class="form-group">
                <label>Nomor Telepon:</label>
                <input type="tel" id="regPhone" placeholder="Masukkan nomor telepon">
            </div>
            <div class="form-group">
                <label>Jabatan:</label>
                <input type="text" id="regPosition" placeholder="Masukkan jabatan">
            </div>
            <div class="form-group">
                <label>Departemen:</label>
                <select id="regDepartment">
                    <option value="">Pilih Departemen</option>
                    <option value="IT">IT</option>
                    <option value="HR">HR</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Finance">Finance</option>
                    <option value="Operations">Operations</option>
                </select>
            </div>
            <div class="form-group">
                <label>Foto Profil:</label>
                <input type="file" id="regPhoto" accept="image/*">
            </div>
            <button class="btn" onclick="registerEmployee()">Daftar</button>
            <button class="btn btn-danger" onclick="showSection('loginSection')">Kembali</button>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <div class="navigation">
                <button class="nav-btn active" onclick="showAdminSection('adminOverview')">Overview</button>
                <button class="nav-btn" onclick="showAdminSection('timeSettings')">Pengaturan Waktu</button>
                <button class="nav-btn" onclick="showAdminSection('employeeManagement')">Kelola Karyawan</button>
                <button class="nav-btn" onclick="showAdminSection('attendanceHistory')">Riwayat Absensi</button>
                <button class="nav-btn" onclick="logout()">Logout</button>
            </div>

            <!-- Admin Overview -->
            <div id="adminOverview" class="card">
                <h2>üìä Dashboard Admin</h2>
                <div class="time-settings">
                    <div>
                        <h3>Status Absensi</h3>
                        <p><span id="attendanceStatus" class="status-indicator status-closed"></span><span id="attendanceStatusText">Ditutup</span></p>
                        <button class="btn" onclick="toggleAttendance()">Toggle Status</button>
                    </div>
                    <div>
                        <h3>Statistik Hari Ini</h3>
                        <p>Total Karyawan: <strong id="totalEmployees">0</strong></p>
                        <p>Hadir Hari Ini: <strong id="presentToday">0</strong></p>
                        <p>Tidak Hadir: <strong id="absentToday">0</strong></p>
                    </div>
                </div>
            </div>

            <!-- Time Settings -->
            <div id="timeSettings" class="card hidden">
                <h2>‚è∞ Pengaturan Waktu Absensi</h2>
                <div class="time-settings">
                    <div class="form-group">
                        <label>Jam Buka Absensi:</label>
                        <input type="time" id="openTime" value="08:00">
                    </div>
                    <div class="form-group">
                        <label>Jam Tutup Absensi:</label>
                        <input type="time" id="closeTime" value="17:00">
                    </div>
                </div>
                <button class="btn" onclick="saveTimeSettings()">Simpan Pengaturan</button>
            </div>

            <!-- Employee Management -->
            <div id="employeeManagement" class="card hidden">
                <h2>üë• Kelola Karyawan</h2>
                <div id="employeeList"></div>
            </div>

            <!-- Attendance History -->
            <div id="attendanceHistory" class="card hidden">
                <h2>üìã Riwayat Absensi</h2>
                <div class="form-group">
                    <label>Filter Tanggal:</label>
                    <input type="date" id="filterDate" onchange="filterAttendanceHistory()">
                </div>
                <div id="historyList"></div>
            </div>
        </div>

        <!-- Employee Dashboard -->
        <div id="employeeDashboard" class="hidden">
            <div class="navigation">
                <button class="nav-btn active" onclick="showEmployeeSection('employeeProfile')">Profil</button>
                <button class="nav-btn" onclick="showEmployeeSection('employeeAttendance')">Absensi</button>
                <button class="nav-btn" onclick="showEmployeeSection('employeeHistory')">Riwayat</button>
                <button class="nav-btn" onclick="logout()">Logout</button>
            </div>

            <!-- Employee Profile -->
            <div id="employeeProfile" class="card">
                <h2>üë§ Profil Saya</h2>
                <div id="currentEmployeeProfile"></div>
            </div>

            <!-- Employee Attendance -->
            <div id="employeeAttendance" class="card hidden">
                <h2>‚úÖ Absensi</h2>
                <div id="attendanceSection">
                    <div class="barcode-container">
                        <h3>Barcode Anda</h3>
                        <div class="barcode" id="employeeBarcode"></div>
                        <p>Scan barcode ini untuk absensi</p>
                    </div>
                    <div class="form-group">
                        <label>Atau masukkan ID manual:</label>
                        <input type="text" id="manualId" placeholder="Masukkan ID karyawan">
                        <button class="btn" onclick="processAttendance()">Absensi</button>
                    </div>
                </div>
            </div>

            <!-- Employee History -->
            <div id="employeeHistory" class="card hidden">
                <h2>üìà Riwayat Absensi Saya</h2>
                <div id="myAttendanceHistory"></div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let employees = JSON.parse(localStorage.getItem('employees') || '[]');
        let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
        let systemSettings = JSON.parse(localStorage.getItem('systemSettings') || '{"openTime": "08:00", "closeTime": "17:00", "attendanceOpen": false}');

        // Initialize admin account if not exists
        if (!employees.find(emp => emp.username === 'admin')) {
            employees.push({
                id: 'ADMIN001',
                username: 'admin',
                password: 'admin123',
                name: 'Administrator',
                role: 'admin',
                email: 'admin@company.com',
                phone: '081234567890',
                position: 'System Administrator',
                department: 'IT',
                photo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjNjY3ZWVhIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udA1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QTwvdGV4dD4KPC9zdmc+',
                registrationDate: new Date().toISOString()
            });
            saveData();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            checkAttendanceStatus();
            setInterval(checkAttendanceStatus, 60000); // Check every minute
        });

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        function checkAttendanceStatus() {
            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5);
            const openTime = systemSettings.openTime;
            const closeTime = systemSettings.closeTime;

            if (currentTime >= openTime && currentTime <= closeTime) {
                systemSettings.attendanceOpen = true;
            } else {
                systemSettings.attendanceOpen = false;
            }
            
            updateAttendanceStatusDisplay();
            saveData();
        }

        function updateAttendanceStatusDisplay() {
            const statusElement = document.getElementById('attendanceStatus');
            const statusTextElement = document.getElementById('attendanceStatusText');
            
            if (systemSettings.attendanceOpen) {
                statusElement.className = 'status-indicator status-open';
                statusTextElement.textContent = 'Dibuka';
            } else {
                statusElement.className = 'status-indicator status-closed';
                statusTextElement.textContent = 'Ditutup';
            }
        }

        function showSection(sectionId) {
            const sections = ['loginSection', 'registerSection', 'adminDashboard', 'employeeDashboard'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function showAdminSection(sectionId) {
            const sections = ['adminOverview', 'timeSettings', 'employeeManagement', 'attendanceHistory'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Load section data
            if (sectionId === 'employeeManagement') {
                loadEmployeeList();
            } else if (sectionId === 'attendanceHistory') {
                loadAttendanceHistory();
            } else if (sectionId === 'adminOverview') {
                updateAdminStats();
            }
        }

        function showEmployeeSection(sectionId) {
            const sections = ['employeeProfile', 'employeeAttendance', 'employeeHistory'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Load section data
            if (sectionId === 'employeeProfile') {
                loadEmployeeProfile();
            } else if (sectionId === 'employeeAttendance') {
                loadEmployeeAttendance();
            } else if (sectionId === 'employeeHistory') {
                loadMyAttendanceHistory();
            }
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            const user = employees.find(emp => emp.username === username && emp.password === password);
            
            if (user) {
                currentUser = user;
                if (user.role === 'admin') {
                    showSection('adminDashboard');
                    updateAdminStats();
                } else {
                    showSection('employeeDashboard');
                    loadEmployeeProfile();
                }
                
                // Clear login form
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            } else {
                alert('Username atau password salah!');
            }
        }

        function logout() {
            currentUser = null;
            showSection('loginSection');
        }

        function registerEmployee() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const position = document.getElementById('regPosition').value;
            const department = document.getElementById('regDepartment').value;
            const photoFile = document.getElementById('regPhoto').files[0];

            if (!name || !email || !phone || !position || !department) {
                alert('Semua field harus diisi!');
                return;
            }

            // Check if email already exists
            if (employees.find(emp => emp.email === email)) {
                alert('Email sudah terdaftar!');
                return;
            }

            // Generate employee ID and username
            const employeeId = 'EMP' + String(employees.length).padStart(3, '0');
            const username = name.toLowerCase().replace(/\s+/g, '') + Math.floor(Math.random() * 100);
            const password = 'password123'; // Default password

            // Handle photo
            let photoData = generateDefaultAvatar(name);
            
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoData = e.target.result;
                    completeRegistration();
                };
                reader.readAsDataURL(photoFile);
            } else {
                completeRegistration();
            }

            function completeRegistration() {
                const newEmployee = {
                    id: employeeId,
                    username: username,
                    password: password,
                    name: name,
                    role: 'employee',
                    email: email,
                    phone: phone,
                    position: position,
                    department: department,
                    photo: photoData,
                    registrationDate: new Date().toISOString()
                };

                employees.push(newEmployee);
                saveData();

                alert(`Pendaftaran berhasil!\n\nUsername: ${username}\nPassword: ${password}\nID Karyawan: ${employeeId}\n\nSilakan login dengan username dan password tersebut.`);

                // Clear form
                document.getElementById('regName').value = '';
                document.getElementById('regEmail').value = '';
                document.getElementById('regPhone').value = '';
                document.getElementById('regPosition').value = '';
                document.getElementById('regDepartment').value = '';
                document.getElementById('regPhoto').value = '';

                showSection('loginSection');
            }
        }

        function generateDefaultAvatar(name) {
            const initial = name.charAt(0).toUpperCase();
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            return `data:image/svg+xml;base64,${btoa(`<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="${color}"/><text x="50" y="55" font-family="Arial" font-size="40" fill="white" text-anchor="middle">${initial}</text></svg>`)}`;
        }

        function toggleAttendance() {
            systemSettings.attendanceOpen = !systemSettings.attendanceOpen;
            updateAttendanceStatusDisplay();
            saveData();
            alert(`Absensi ${systemSettings.attendanceOpen ? 'dibuka' : 'ditutup'}`);
        }

        function saveTimeSettings() {
            systemSettings.openTime = document.getElementById('openTime').value;
            systemSettings.closeTime = document.getElementById('closeTime').value;
            saveData();
            alert('Pengaturan waktu berhasil disimpan!');
        }

        function updateAdminStats() {
            const today = new Date().toDateString();
            const todayAttendance = attendanceHistory.filter(att => new Date(att.date).toDateString() === today);
            
            document.getElementById('totalEmployees').textContent = employees.filter(emp => emp.role === 'employee').length;
            document.getElementById('presentToday').textContent = todayAttendance.length;
            document.getElementById('absentToday').textContent = employees.filter(emp => emp.role === 'employee').length - todayAttendance.length;
            
            updateAttendanceStatusDisplay();
        }

        function loadEmployeeList() {
            const employeeList = document.getElementById('employeeList');
            const employeeEmps = employees.filter(emp => emp.role === 'employee');
            
            employeeList.innerHTML = employeeEmps.map(emp => `
                <div class="employee-card">
                    <img src="${emp.photo}" alt="${emp.name}" class="profile-pic">
                    <div class="employee-info">
                        <h4>${emp.name}</h4>
                        <p>ID: ${emp.id} | ${emp.position}</p>
                        <p>Departemen: ${emp.department}</p>
                        <p>Email: ${emp.email}</p>
                    </div>
                    <div class="employee-actions">
                        <button class="btn btn-danger" onclick="deleteEmployee('${emp.id}')">Hapus</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteEmployee(employeeId) {
            if (confirm('Yakin ingin menghapus karyawan ini?')) {
                employees = employees.filter(emp => emp.id !== employeeId);
                // Also remove attendance history
                attendanceHistory = attendanceHistory.filter(att => att.employeeId !== employeeId);
                saveData();
                loadEmployeeList();
                updateAdminStats();
                alert('Karyawan berhasil dihapus!');
            }
        }

        function loadAttendanceHistory() {
            const historyList = document.getElementById('historyList');
            const sortedHistory = attendanceHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            historyList.innerHTML = sortedHistory.map(att => {
                const employee = employees.find(emp => emp.id === att.employeeId);
                const date = new Date(att.date);
                return `
                    <div class="employee-card">
                        <img src="${employee?.photo || ''}" alt="${employee?.name || 'Unknown'}" class="profile-pic">
                        <div class="employee-info">
                            <h4>${employee?.name || 'Unknown Employee'}</h4>
                            <p>ID: ${att.employeeId}</p>
                            <p>Tanggal: ${date.toLocaleDateString('id-ID')}</p>
                            <p>Waktu: ${date.toLocaleTimeString('id-ID')}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterAttendanceHistory() {
            const filterDate = document.getElementById('filterDate').value;
            if (!filterDate) {
                loadAttendanceHistory();
                return;
            }
            
            const historyList = document.getElementById('historyList');
            const filteredHistory = attendanceHistory.filter(att => {
                const attDate = new Date(att.date).toDateString();
                const filterDateObj = new Date(filterDate).toDateString();
                return attDate === filterDateObj;
            });
            
            historyList.innerHTML = filteredHistory.map(att => {
                const employee = employees.find(emp => emp.id === att.employeeId);
                const date = new Date(att.date);
                return `
                    <div class="employee-card">
                        <img src="${employee?.photo || ''}" alt="${employee?.name || 'Unknown'}" class="profile-pic">
                        <div class="employee-info">
                            <h4>${employee?.name || 'Unknown Employee'}</h4>
                            <p>ID: ${att.employeeId}</p>
                            <p>Tanggal: ${date.toLocaleDateString('id-ID')}</p>
                            <p>Waktu: ${date.toLocaleTimeString('id-ID')}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadEmployeeProfile() {
            const profileDiv = document.getElementById('currentEmployeeProfile');
            profileDiv.innerHTML = `
                <div class="employee-card">
                    <img src="${currentUser.photo}" alt="${currentUser.name}" class="profile-pic">
                    <div class="employee-info">
                        <h3>${currentUser.name}</h3>
                        <p><strong>ID:</strong> ${currentUser.id}</p>
                        <p><strong>Username:</strong> ${currentUser.username}</p>
                        <p><strong>Jabatan:</strong> ${currentUser.position}</p>
                        <p><strong>Departemen:</strong> ${currentUser.department}</p>
                        <p><strong>Email:</strong> ${currentUser.email}</p>
                        <p><strong>Telepon:</strong> ${currentUser.phone}</p>
                        <p><strong>Terdaftar:</strong> ${new Date(currentUser.registrationDate).toLocaleDateString('id-ID')}</p>
                    </div>
                </div>
            `;
        }

        function loadEmployeeAttendance() {
            document.getElementById('employeeBarcode').textContent = currentUser.id;
            
            if (!systemSettings.attendanceOpen) {
                document.getElementById('attendanceSection').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>‚è∞ Absensi Ditutup</h3>
                        <p>Jam absensi: ${systemSettings.openTime} - ${systemSettings.closeTime}</p>
                        <p>Silakan kembali pada jam kerja.</p>
                    </div>
                `;
            } else {
                document.getElementById('attendanceSection').innerHTML = `
                    <div class="barcode-container">
                        <h3>Barcode Anda</h3>
                        <div class="barcode" id="employeeBarcode">${currentUser.id}</div>
                        <p>Scan barcode ini untuk absensi</p>
                    </div>
                    <div class="form-group">
                        <label>Atau masukkan ID manual:</label>
                        <input type="text" id="manualId" placeholder="Masukkan ID karyawan" value="${currentUser.id}">
                        <button class="btn" onclick="processAttendance()">Absensi</button>
                    </div>
                `;
            }
        }

        function processAttendance() {
            if (!systemSettings.attendanceOpen) {
                alert('Absensi sedang ditutup!');
                return;
            }

            const employeeId = document.getElementById('manualId').value || currentUser.id;
            const employee = employees.find(emp => emp.id === employeeId);
            
            if (!employee) {
                alert('ID karyawan tidak ditemukan!');
                return;
            }

            // Check if already attended today
            const today = new Date().toDateString();
            const alreadyAttended = attendanceHistory.some(att => 
                att.employeeId === employeeId && 
                new Date(att.date).toDateString() === today
            );

            if (alreadyAttended) {
                alert('Anda sudah melakukan absensi hari ini!');
                return;
            }

            // Record attendance
            const attendance = {
                id: 'ATT' + Date.now(),
                employeeId: employeeId,
                employeeName: employee.name,
                date: new Date().toISOString(),
                status: 'hadir'
            };

            attendanceHistory.push(attendance);
            saveData();

            alert(`Absensi berhasil!\n\nNama: ${employee.name}\nWaktu: ${new Date().toLocaleString('id-ID')}`);
            
            // Refresh attendance section
            loadEmployeeAttendance();
        }

        function loadMyAttendanceHistory() {
            const historyDiv = document.getElementById('myAttendanceHistory');
            const myHistory = attendanceHistory
                .filter(att => att.employeeId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (myHistory.length === 0) {
                historyDiv.innerHTML = '<p style="text-align: center; color: #666;">Belum ada riwayat absensi.</p>';
                return;
            }

            historyDiv.innerHTML = myHistory.map(att => {
                const date = new Date(att.date);
                return `
                    <div class="employee-card">
                        <div class="employee-info">
                            <h4>Absensi ${att.status === 'hadir' ? '‚úÖ Hadir' : '‚ùå Tidak Hadir'}</h4>
                            <p>Tanggal: ${date.toLocaleDateString('id-ID')}</p>
                            <p>Waktu: ${date.toLocaleTimeString('id-ID')}</p>
                            <span class="attendance-status ${att.status === 'hadir' ? 'status-hadir' : 'status-tidak-hadir'}">
                                ${att.status.toUpperCase()}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function saveData() {
            try {
                localStorage.setItem('employees', JSON.stringify(employees));
                localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
                localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Load initial time settings
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('openTime').value = systemSettings.openTime || '08:00';
            document.getElementById('closeTime').value = systemSettings.closeTime || '17:00';
        });
    </script>
</body>
</html>